<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <title>Productivity App</title>
    <script type="module">
        // Force cache refresh for imports
        const importCacheBuster = '?v=4&t=' + Date.now();
        
        // Always redirect to auth first - let auth page handle redirect to desktop if already authenticated
        async function redirectToAuth() {
            const { CONFIG } = await import('./frontend/js/config.js' + importCacheBuster);
            const token = localStorage.getItem(CONFIG.STORAGE.AUTH_TOKEN);
            
            // If no token, go to auth
            if (!token) {
                window.location.href = 'frontend/apps/auth.html';
                return;
            }
            
            // If token exists, verify it
            try {
                const response = await fetch(`${CONFIG.API.BASE_URL}${CONFIG.API.ENDPOINTS.AUTH.ME}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    // Already authenticated, go directly to desktop
                    window.location.href = 'frontend/desktop.html';
                } else {
                    // Token invalid, clear and go to auth
                    localStorage.removeItem(CONFIG.STORAGE.AUTH_TOKEN);
                    localStorage.removeItem(CONFIG.STORAGE.CURRENT_USER);
                    window.location.href = 'frontend/apps/auth.html';
                }
            } catch (error) {
                // Connection error - if token exists, try desktop (might be offline)
                // Otherwise go to auth
                if (token) {
                    window.location.href = 'frontend/desktop.html';
                } else {
                    window.location.href = 'frontend/apps/auth.html';
                }
            }
        }
        
        redirectToAuth();
    </script>
</head>
<body>
    <div style="text-align: center; padding: 50px; font-family: monospace;">
        <p>Loading...</p>
    </div>
</body>
</html>
